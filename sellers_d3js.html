<!doctype html>
<html>
  <head>
    <title>meLive</title>
    <style>
        .chart div {
              font: 10px sans-serif;
              background-color: steelblue;
              text-align: right;
              padding: 3px;
              margin: 1px;
              color: white;
        }
    </style>
  </head>
  <body>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <div>
        <h2>meLive</h2>
        <h3>Sellers Conversion Rates</h3>
    </div>
    <div class="chart">
    <div id="items">
    </div>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://raw.githubusercontent.com/javve/list.js/v1.1.1/dist/list.min.js"></script>
    <script>     
            
        function drawBar(data){
            
            //data is an array of two items
            var values = [];
            for(key in data) {
                if(data.hasOwnProperty(key)) {
                    var value = data[key][1];
                    values.push(value);
                }
            }
            
            var x = d3.scale.linear()
            .domain([0, d3.max(values)])
            .range([0, 420]);
            
            d3.select(".chart")
              .selectAll("div")
                .data(data)
              .enter().append("div")
                .style("width", function(d) { return x(d[1]) + "px"; })
                .text(function(d) { 
                        var legend = d[0] + "(" + d[1] + ")";
                        return legend;
                      });
        };
        var socket = io();

        //var data = [];
        socket.on('sellers:80183917', function(msg){
          var seller = $.parseJSON(msg);
          var sales = [];
          var visits = [];
          var conversion = [];
          var items = seller['items'];
          
          var data = [];
          for(item in items) {
            var item_data = items[item];
            //data.push(item_data)
            data.push([item_data['title'], item_data['today_visits'], item_data['sold_today'], item_data['conversion-rate']]);
          }
          
          //oTable.dataTable(data);
          
          $(".chart").html("");
          drawBar(data);
          
        });
    </script>
    
  </body>
</html>
